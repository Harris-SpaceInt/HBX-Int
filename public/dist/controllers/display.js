"use strict";var app=angular.module("display",["myApp"]);app.controller("displayCtrl",function(e,t,r,s,a,o,c){e.benchmark=1e5,e.showSelectedProjects=!1,e.showPrevReports=!1,e.expandedList=!1,e.prev_reports=!1,e.checked=[],e.report_projects=[],e.report_date="",e.currentReport=null,e.reverse=!0,e.sortOrder="savings",a.resetDisciplines(),e.disciplines=a.disciplines,e.projectDisciplines=[],e.database=s,e.sharedData=r,e.pdf=o,e.pageInit=function(){e.database.getItemsFromDatabase();for(var t=0;t<e.database.projects.length;t++)e.database.projects[t].visible=!0;e.sharedData.checkAdmin()||e.sharedData.setAdmin()},e.switchToFull=function(){t.location.href="#!/previous"},e.showFull=function(e){r.project=e,t.location.href="#!/previous"},e.hideReports=function(){e.prev_reports=!1,e.report_projects=[]},e.setShowPrevReports=function(){e.showPrevReports=!e.showPrevReports,e.expandedList=!1},e.setPrevReports=function(){e.prev_reports=!e.prev_reports},e.setSelectedProjects=function(){e.showSelectedProjects=!e.showSelectedProjects},e.expandList=function(){e.expandedList=!0},e.addReportsToDisplay=function(t){var r=s.getReportFromDatabase(t._id);r.then(function(){if(t=s.currentReport,e.setPrevReports(),e.prev_reports){e.report_projects=[];for(var r=0;r<t.project.length;r++)e.report_projects.push(t.project[r]);e.report_date=t.month+"/"+t.day+"/"+t.year,e.currentReport=t}})},e.setSortOrder=function(t){"checked"===t||"savings"===t||"hours"===t||"date"===t?e.reverse=e.sortOrder===t?!e.reverse:!0:e.reverse=e.sortOrder===t?!e.reverse:!1,e.sortOrder=t},e.somethingChecked=function(){for(var t=0;t<e.database.projects.length;t++)if(e.database.projects[t].checked)return!0;return!1},e.majorSelection=!1,e.selectFunction=function(){e.majorSelection?e.selectAll():e.deselectAll()},e.selectAll=function(){for(var e=0;e<s.projects.length;e++)s.projects[e].generated||(s.projects[e].visible||void 0===s.projects[e].visible)&&(s.projects[e].checked=!0)},e.deselectAll=function(){for(var e=0;e<s.projects.length;e++)s.projects[e].generated||(s.projects[e].checked=!1)},e.noOrAllDisciplines=function(){e.database.projects.forEach(function(e){e.visible=!0})},e.filterDisciplines=function(){for(var t=[],r=0;r<e.disciplines.length;r++)e.disciplines[r].ticked&&t.push(e.disciplines[r].label);if(0===t.length||t.length===e.disciplines.length)e.noOrAllDisciplines();else for(var r=0;r<e.database.projects.length;r++){var s=e.database.projects[r];s.visible=!1;for(var a=0;a<s.discipline.length;a++){var o=t.indexOf(s.discipline[a]);o>-1&&(s.visible=!0)}s.visible||(s.checked=!1),e.database.projects[r]=s}},e.createReport=function(){for(var t=new Date,r={project:[],day:t.getDate(),month:t.getMonth()+1,year:t.getFullYear(),savings:0,hours:0},a=[],c=0;c<e.database.projects.length;c++)if(e.database.projects[c].checked===!0){e.database.projects[c].generated=!0,e.database.projects[c].checked=!1,s.updateProjectFromDatabase(s.projects[c]._id,s.projects[c]),r.savings+=e.database.projects[c].savings,r.hours+=e.database.projects[c].hours,a.push(e.database.projects[c]);var n={_id:e.database.projects[c]._id};r.project.push(n)}e.database.addReportToDatabase(r),r.project=a,o.createReportPDF(r)},e.numChecked=function(){for(var t=0,r=0;r<e.database.projects.length;r++)e.database.projects[r].checked===!0&&t++;return t},e.totalSavings=function(){for(var t=0,r=0;r<e.database.projects.length;r++)e.database.projects[r].checked===!0&&(t+=c.projectSavings(e.database.projects[r]));return t},e.totalHours=function(){for(var t=0,r=0;r<e.database.projects.length;r++)e.database.projects[r].checked===!0&&(t+=c.projectHours(e.database.projects[r]));return t},e.benchmarkReached=function(t){return t>=e.benchmark},e.pageInit()});