"use strict";var app=angular.module("entry",["myApp"]);app.controller("entryCtrl",function(e,i,t,r,s,a,n){e.itemsToAdd=[],e.resultsToAdd=[],e.update=!1,e.savingsNumber=!0,e.hoursNumber=!0,e.hasImage=!1,e.validate=n,e.sharedData=t,e.dateOptions={changeYear:!0,changeMonth:!0,yearRange:"2010:-0"},e.disciplines=s.disciplines,e.projectDisciplines=[],e.pageInit=function(){if(t.loggedIn())if(null===t.project)e.addNew();else{e.itemsToAdd.push(t.project),null!==t.project.image&&(e.hasImage=!0),e.itemsToAdd[0].date=new Date(t.project.year,t.project.month-1,t.project.day);for(var r=0;r<t.project.result.length;r++)e.resultsToAdd.push({summary:t.project.result[r].summary,details:t.project.result[r].details,savings:t.project.result[r].savings,hours:t.project.result[r].hours});for(var s=0;s<t.project.discipline.length;s++)switch(t.project.discipline[s]){case"Software":e.disciplines[0].ticked=!0;break;case"Systems":e.disciplines[1].ticked=!0;break;case"Electrical":e.disciplines[2].ticked=!0;break;case"Mechanical":e.disciplines[3].ticked=!0;break;case"Production":e.disciplines[0].ticked=!0;break;case"Integration and Test":e.disciplines[1].ticked=!0;break;case"Corporate":e.disciplines[2].ticked=!0;break;case"Program Management":e.disciplines[3].ticked=!0}e.update=!0,t.project=null}else i.location.href="#!/login"},e.addNew=function(){e.itemsToAdd.length>=1?alert("Fill out existing report(s) first!"):(s.resetDisciplines(),e.addResultsField(),e.itemsToAdd.push({title:"",discipline:[],disciplineString:"",month:"",day:"",year:"",date:"",manager:"",team:"",summary:"",result:e.resultsToAdd,image:null}))},e.updateDisciplines=function(i){for(var t=0;t<e.disciplines.length;t++){var r=e.disciplines[t].ticked;r&&i.discipline.push(e.disciplines[t].label)}},e.alertDisciplines=function(){for(var i="",t=0;t<e.disciplines.length;t++)e.disciplines[t].ticked&&(i+=e.disciplines[t].label+" ");alert(i)},e.noDiscipline=function(){for(var i=0;i<e.disciplines.length;i++)if(e.disciplines[i].ticked)return!1;return!0},e.checkSavingsNumberInput=function(i){var t=e.resultsToAdd[i].savings;""===t?e.savingsNumber=!0:e.savingsNumber=!isNaN(t)},e.checkHoursNumberInput=function(i){var t=e.resultsToAdd[i].hours;""==t?e.hoursNumber=!0:e.hoursNumber=!isNaN(t)},e.addResultsField=function(){e.resultsToAdd.push({summary:"",details:"",savings:"",hours:""})},e.redirect=function(){var s=r.getManagerByEmail(t.globalManager[0].email);s.then(function(r){t.project=null,e.managerExists=null!==r,e.managerExists?i.location.href="#!/previous":t.logOut()})},e.delProjectForm=function(){t.project=null,t.projectList.length>0?i.location.href="#!/preview":e.redirect()},e.cancelEdit=function(){t.project=null,i.location.href="#!/previous"},e.removeImage=function(){e.itemsToAdd[0].image=null,e.hasImage=!1},e.delResultsField=function(i){e.resultsToAdd.length>1?e.resultsToAdd.splice(i,1):alert("Cannot delete only result")},e.parseDate=function(e){return e.month=e.date.getMonth()+1,e.day=e.date.getDate(),e.year=e.date.getFullYear(),e},e.validateProject=function(i){if(e.validate.validateField(i.title)){if(void 0===i.date||null===i.date)return alert("Invalid date"),!1;if(e.validate.validateField(i.summary)){if(e.noDiscipline())return alert("No disciplines selected"),!1;for(var t=0;t<e.resultsToAdd.length;t++){if(!e.validate.validateField(e.resultsToAdd[t].summary))return alert("Invalid improvement description in result "+(t+1)),!1;if(!e.validate.validateField(e.resultsToAdd[t].details))return alert("Invalid results accomplished in result "+(t+1)),!1}return!0}return alert("Invalid summary"),!1}return alert("Invalid project title"),!1},e.legitSavings=function(e){return e.savings<0?(alert("Error: Negative savings"),!1):e.hours<0?(alert("Error: Negative hours"),!1):e.savings<=0&&e.hours<=0?(alert("Error: project has no savings"),!1):!0},e.updateResults=function(i){i.result=[];for(var t=0;t<e.resultsToAdd.length;t++){var r=e.resultsToAdd[t],s=n.validateSavings(r.savings),l=n.validateSavings(r.hours);if(!s&&!l)return alert("Need at least savings or hours in result "+(t+1)),!1;!s&&!l||s&&l||(s?l||(r.hours=0):r.savings=0),i.result.push(r)}return i.savings=a.projectSavings(i),i.hours=a.projectHours(i),!0},e.compileProject=function(i){return e.validateProject(i)&&(i=e.parseDate(i),e.updateResults(i)&&e.legitSavings(i))?!0:!1},e.addProject=function(r){e.compileProject(r)&&(r.manager=t.globalManager[0],e.updateDisciplines(r),t.pushToProjectList(angular.copy(r)),i.location.href="#!/preview")},e.updateProject=function(s){if(e.compileProject(s))if(t.fromDatabase){var a=r.updateProjectFromDatabase(s._id,s);a.then(function(){t.project=null,t.fromDatabase=!1,i.location.href="#!/previous"})}else t.pushToProjectList(angular.copy(s)),i.location.href="#!/preview"},e.pageInit()});