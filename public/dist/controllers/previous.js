"use strict";var app=angular.module("previous",["myApp"]);app.controller("previousCtrl",function(e,t,r,a,s){e.userProjects=[],e.generatedUserProjects=[],e.items=[],e.showingGenerated=!1,e.searchTerm="",e.showingFullView=!1,e.database=s,e.sharedData=a,e.pageInit=function(){if(e.sharedData.loggedIn())if(a.checkAdmin()&&null!==a.project)e.items.push(a.project),a.project=null,e.showingFullView=!0;else{var r=e.loadUserProjects(!1);r.then(function(){e.items=e.userProjects})}else t.location.href="#!/login"},e.switchToDisplay=function(){t.location.href="#!/display"},e.loadUserProjects=function(){var t=r.defer();if(e.sharedData.checkAdmin()){var o=s.getProjectsFromDatabase();o.then(function(r){if(e.userProjects=r,e.showingGenerated){var a=s.getGenearatedProjectsFromDatabase();a.then(function(r){e.generatedUserProjects=r,t.resolve()})}else t.resolve()})}else{var o=s.getManagerProjectsFromDatabase(a.globalManager[0].email);o.then(function(r){if(e.userProjects=r,e.showingGenerated){var o=s.getGeneratedManagerProjectsFromDatabase(a.globalManager[0].email);o.then(function(r){e.generatedUserProjects=r,t.resolve()})}else t.resolve()})}return t.promise},e.editManager=function(){t.location.href="#!/manage"},e.addProject=function(){t.location.href="#!/entry"},e.showGenerated=function(){e.showingGenerated=!0;var t=e.loadUserProjects();t.then(function(){e.items=[];for(var t=0;t<e.userProjects.length;t++)e.items.push(e.userProjects[t]);for(var t=0;t<e.generatedUserProjects.length;t++)e.items.push(e.generatedUserProjects[t])})},e.hideGenerated=function(){e.showingGenerated=!1,e.items=[];for(var t=0;t<e.userProjects.length;t++)e.items.push(e.userProjects[t])},e.searchAndUpdate=function(){e.items=[],e.searchList(e.userProjects),e.showingGenerated&&e.searchList(e.generatedUserProjects)},e.searchList=function(t){for(var r=0;r<t.length;r++){var a=t[r].title,s=t[r].manager.email,o=t[r].manager.name,n=e.searchTerm.toLowerCase();a=a.toLowerCase(),s=s.toLowerCase(),o=o.toLowerCase(),e.sharedData.checkAdmin()?a.indexOf(n)>-1?e.items.push(t[r]):s.indexOf(n)>-1?e.items.push(t[r]):o.indexOf(n)>-1&&e.items.push(t[r]):a.indexOf(n)>-1&&e.items.push(t[r])}},e.clearSearch=function(){e.searchTerm="",e.searchAndUpdate()},e.editProject=function(r){a.fromDatabase=!0,a.project=e.items[r],t.location.href="#!/entry"},e.deleteProject=function(t){var r=confirm("Are you sure you want to delete the project, "+e.items[t].title+"?");if(r){var a=e.database.deleteProjectFromDatabase(e.items[t]._id);a.then(function(){e.items=[],e.userProjects=[],e.generatedUserProjects=[];var t=s.getItemsFromDatabase();t.then(function(){s.projects.forEach(function(e){e.checked=!1}),e.loadUserProjects(),e.searchAndUpdate()})})}},e.pageInit()});